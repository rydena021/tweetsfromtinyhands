<style>

</style>

<div id="word-cloud"></div>

<script>

// set dimensions
var margin = {top: 20, right: 20, bottom: 20, left: 20},
    width = 1200 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

// load json file
d3.json("<%= asset_path 'final/words/2015-06-01.json' %>", function(error, data) {

  // setup for word array
  var data = data.words;
  var words = [];

  data.forEach(function(d) {
    words.push(d.term);
  });

  // set colors and font range
  var colors = ['#1DCAFF','#9AD4FF','blue','grey','white']
  var fontSize = d3.scale.pow().exponent(2).domain([0,1]).range([25,120]);

  // see API reference at https://github.com/jasondavies/d3-cloud
  var layout = d3.layout.cloud()
      .timeInterval(10)
      .size([width, height])
      .words(data)
      .rotate(function() { return (~~(Math.random() * 6) - 3) * 5; })
      .font('Baloo')
      .fontSize(function(d,i) { return fontSize(d.frequency/20); })
      .text(function(d) { return d.term; })
      .spiral("archimedean")
      .on("end", draw)
      .start();

  // select element by id and append svg element
  var svg = d3.select("#word-cloud").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .style("background", "black")
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  // set dimensions for actual word cloud
  var wordcloud = svg.append("g")
      .attr("transform", "translate(" + width/2 + "," + height/2 + ")");

  // place individual words onto word cloud canvas
  function draw(words) {
    wordcloud.selectAll("text")
        .data(words)
      .enter().append("text")
        .attr('class','word')
        .style("font-size", function(d) { return d.size + "px"; }) // assign font size
        .style("font-family", function(d) { return d.font; })
        .style("fill", function(d) {
            return setRandomColor(d);
        })
        .attr("text-anchor", "middle")
        .attr("transform", function(d) { return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")"; })
        .text(function(d) { return d.text; });
  };
  // randomize color for individual words
  function setRandomColor(word) {
      var i = Math.floor(Math.random(colors.length) * colors.length);
      return colors[i];
  };
});
</script>
