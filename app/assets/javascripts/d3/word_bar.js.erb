d3.json("<%= asset_path 'word_frequency/2016-09-01.json' %>", function(error, data) {

  // Set the dimensions of the canvas / graph
  var margin = {top: 30, right: 20, bottom: 30, left: 100},
  width = 600 - margin.left - margin.right,
  height = 500 - margin.top - margin.bottom;

  // Ensure correct order
  var words = data.words.slice(0, 10).sort(function(a, b){return b.frequency-a.frequency});

  // Setup arrays and reassign data
  var mentions = [],
      categories = [''];

  words.forEach(function(d) {
    categories.push(d.term);
    mentions.push(d.frequency);
  });

  // Color set
  var colors = ['#1DCAFF','#0000b4','#0082ca','#285964','#0d4bcf','#0066AE','#074285','#00187B','#0094ff','#405F83'];

  var colorScale = d3.scale.quantize()
          .domain([0,colors.length])
          .range(colors);

  // Set the ranges
  var xScale = d3.scale.linear().domain([0, words[0].frequency]).range([0, width]);
  var yScale = d3.scale.linear().domain([0,11]).range([0, height]);

  // Add the svg canvas
  var svg = d3.select("#word-bar")
      .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
      .append("g")
          .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

  // Define the axes
  var xAxis = d3.svg.axis();
    xAxis
      .orient('bottom')
      .scale(xScale);

  var yAxis = d3.svg.axis();
    yAxis
      .orient('left')
      .scale(yScale)
      .tickFormat(function(d,i){ return categories[i]; })

  // Add the X Axis
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  // Add the Y Axis
  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis);

  // Add individual bars
  svg.selectAll('rect')
      .data(mentions)
      .enter()
      .append('rect')
      .attr('height',33)
      .attr({'x':0,'y':function(d,i){ return yScale(i)+19; }})
      .style('fill',function(d,i){ return colorScale(i); })
      .attr('width',function(d){ return 0; });

  // Transition delay
  var transit = d3.select("#word-bar").selectAll("rect")
              .data(mentions)
              .transition()
              .duration(1000)
              .attr("width", function(d) {return xScale(d); });

});
